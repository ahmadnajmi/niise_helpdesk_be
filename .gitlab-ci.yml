stages:
  - deploy

# Deploy to Staging
deploy_staging:
  stage: deploy
  tags:
    - server_staging  
  script:
    - echo "Deploying to Staging..."
    - cd /var/www/html/helpdesk_be  
    - git pull origin staging
    - npm install
    - npm run build
    - php artisan migrate --force
    - php artisan optimize
    - echo "Staging deployment completed!"
  when: manual
  only:
    - staging
  environment:
    name: staging

# Deploy to Pre Prod 1 - SIT
deploy_preprod1_SIT:
  stage: deploy
  tags:
    - server_preprod1  
  script:
    - echo "Deploying to Pre Prod 1 - SIT ..."
    - cd /var/www/html/helpdesk/be  
    - git pull origin main
    - npm install
    - npm run build
    - php artisan migrate --force
    - php artisan optimize
    - echo "Pre Prod 1 - SIT deployment completed!"
  when: manual
  only:
    - staging
  environment:
    name: preprod1-sit

# Deploy to Pre Prod 1 - INTERIM
deploy_preprod1_INTERIM:
  stage: deploy
  tags:
    - server_preprod1  
  script:
    - echo "Deploying to Pre Prod 1 - INTERIM ..."
    - cd /var/www/html/interim/be  
    - git pull origin main
    - npm install
    - npm run build
    - php artisan migrate --force
    - php artisan optimize
    - echo "Pre Prod 1 - INTERIM deployment completed!"
  when: manual
  only:
    - staging
  environment:
    name: preprod1-interim



# Deploy to Pre Prod 2 - SIT
deploy_preprod2_SIT:
  stage: deploy
  tags:
    - server_preprod2
  script:
    - echo "Deploying to Pre Prod 2 - SIT ..."
    - cd /var/www/html/helpdesk/be  
    - git pull origin main
    - npm install
    - npm run build
    - php artisan migrate --force
    - php artisan optimize
    - echo "Pre Prod 2 - SIT deployment completed!"
  when: manual
  only:
    - staging
  environment:
    name: preprod2-sit


# ============================================
# PRE PROD 2 DEPLOYMENT (1 environment)
# ============================================

# Deploy to Pre Prod 2 - SIT
# deploy_preprod2_sit:
#   stage: deploy
#   tags:
#     - preprod2  # Runner tag for Pre Prod 2 server
#   script:
#     - echo "Deploying to Pre Prod 2 - SIT..."
    
#     # Navigate to SIT folder on Pre Prod 2
#     - cd /var/www/sit  # Change to your actual path
    
#     # Pull latest code
#     - git pull origin main
    
#     # Install/update and build
#     - npm install
#     - npm run build
    
#     # Laravel commands
#     - php artisan migrate --force
#     - php artisan optimize
    
#     - echo "Pre Prod 2 - SIT deployment completed!"
#   when: manual
#   only:
#     - main
#   environment:
#     name: preprod2-sit