stages:
  - deploy

# Deploy to Staging
deploy_staging:
  stage: deploy
  tags:
    - helpdesk_niise_be  # Runner tag for Staging server
  script:
    - echo "Deploying to Staging..."
    
    # Navigate to Staging folder on Staging
    - cd /var/www/html/helpdesk_be  # Change to your actual path
    
    # Pull latest code
    - git pull origin staging
    
    # Install/update and build
    - npm install
    - npm run build
    
    # Laravel commands
    - php artisan migrate --force
    - php artisan optimize
    
    - echo "Staging deployment completed!"
  when: manual
  only:
    - staging
  environment:
    name: staging

# Deploy to Pre Prod 1 - Interim
# deploy_preprod1_interim:
#   stage: deploy
#   tags:
#     - preprod1  # Same runner tag for Pre Prod 1 server
#   script:
#     - echo "Deploying to Pre Prod 1 - Interim..."
    
#     # Navigate to Interim folder on Pre Prod 1
#     - cd /var/www/interim  # Change to your actual path
    
#     # Pull latest code
#     - git pull origin main
    
#     # Install/update and build
#     - npm install
#     - npm run build
    
#     # Laravel commands
#     - php artisan migrate --force
#     - php artisan optimize
    
#     - echo "Pre Prod 1 - Interim deployment completed!"
#   when: manual
#   only:
#     - main
#   environment:
#     name: preprod1-interim

# ============================================
# PRE PROD 2 DEPLOYMENT (1 environment)
# ============================================

# Deploy to Pre Prod 2 - SIT
# deploy_preprod2_sit:
#   stage: deploy
#   tags:
#     - preprod2  # Runner tag for Pre Prod 2 server
#   script:
#     - echo "Deploying to Pre Prod 2 - SIT..."
    
#     # Navigate to SIT folder on Pre Prod 2
#     - cd /var/www/sit  # Change to your actual path
    
#     # Pull latest code
#     - git pull origin main
    
#     # Install/update and build
#     - npm install
#     - npm run build
    
#     # Laravel commands
#     - php artisan migrate --force
#     - php artisan optimize
    
#     - echo "Pre Prod 2 - SIT deployment completed!"
#   when: manual
#   only:
#     - main
#   environment:
#     name: preprod2-sit